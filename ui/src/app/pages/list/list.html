<!-- Top users grid -->
<div class="users-grid">
  @for (user of energy.usersWithGenerators(); track $index) {
  <mat-card class="user-card">
    <!-- User Info -->
    <div class="user-info">
      <div>Name: {{ user.user.name }}</div>
      <div>Balance: {{ user.user.balance }}</div>
      <div>Energy Stored: {{ user.user.energyStored }}</div>
      <div>Id: {{ user.user.id }}</div>
      <div>Created At: {{ user.user.createdAt }}</div>
      <div>Updated At: {{ user.user.updatedAt }}</div>
    </div>

    <button mat-raised-button color="primary" (click)="energy.selectUser(user)">
      Select
    </button>

    <mat-accordion multi>
      <!-- Generators Panel -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            Generators ({{ user.generators.length }})
          </mat-panel-title>
        </mat-expansion-panel-header>

        @for (gen of user.generators; track $index) {
        <mat-card class="generator-card">
          <div>Type: {{ gen.type }}</div>
          <div>Production Rate: {{ gen.productionRate }}</div>
          <div>Status: {{ gen.status }}</div>
          <div>Last Generated: {{ gen.lastGeneratedAt || 'Never' }}</div>
        </mat-card>
        } @empty {
        <p>No generators for this user.</p>
        }
      </mat-expansion-panel>

      <!-- Transactions Panel -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            Transactions
          </mat-panel-title>
        </mat-expansion-panel-header>

        @for (tx of user.transactions || []; track $index) {
        <mat-card class="transaction-card">
          <div>Seller: {{ "tx.sellerId" }}</div>
          <div>Buyer: {{ "tx.buyerId || 'Market'" }}</div>
          <div>Energy: {{ "tx.energyAmount" }} kWh</div>
          <div>Price: {{ "tx.pricePerKwh" }}</div>
          <div>Total: {{ "tx.totalPrice" }}</div>
          <div>Date: {{ "tx.createdAt" }}</div>
        </mat-card>
        } @empty {
        <p>No transactions for this user.</p>
        }
      </mat-expansion-panel>
    </mat-accordion>
  </mat-card>
  } @empty {
  <p>There are no users.</p>
  }
</div>



<!-- Pagination buttons -->
<div class="pagination">
  <button mat-raised-button (click)="energy.prev()" [disabled]="energy.offset === 0">
    Previous
  </button>
  <button mat-raised-button (click)="energy.next()">
    Next
  </button>
</div>

<!-- Selected users for transaction -->
@if (energy.transactionUsers().length > 0) {
<div class="transaction-header">
  <h3>Selected Users for Transaction</h3>
</div>
<div class="transaction-users-grid">
  @for (user of energy.transactionUsers(); track $index) {
  <mat-card class="user-card picked">
    <div class="user-info">
      <div>Name: {{ user.user.name }}</div>
      <div>Balance: {{ user.user.balance }}</div>
      <div>Energy Stored: {{ user.user.energyStored }}</div>
      <div>Id: {{ user.user.id }}</div>
    </div>
    <button mat-raised-button color="warn" (click)="energy.deselectUser(user)">
      Remove
    </button>
  </mat-card>
  }
</div>
}
