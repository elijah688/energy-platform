<!-- generator-form.component.html -->
<div class="form-container">
  <mat-card class="form-card">
    <mat-card-header class="form-header">
      <mat-card-title class="form-title">
        {{ isEditMode ? 'Edit User Generators' : 'Create New User' }}
      </mat-card-title>
      <mat-card-subtitle class="form-subtitle">
        {{ isEditMode ? 'Manage your energy generators' : 'Set up user profile and energy generators' }}
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="energy-form">
        <!-- User Info Section -->
        <section class="form-section">
          <h2 class="section-title">User Information</h2>

          <mat-form-field appearance="outline" class="form-field-full">
            <mat-label>User Name</mat-label>
            <input
              matInput
              id="name"
              type="text"
              formControlName="name"
              placeholder="Enter user name"
            >
            @if (hasError('name', 'required')) {
              <mat-error>User name is required</mat-error>
            }
            @if (hasError('name', 'minlength')) {
              <mat-error>User name must be at least 2 characters</mat-error>
            }
          </mat-form-field>
        </section>

        <!-- Generator Controls Section -->
        <section class="form-section">
          <h2 class="section-title">Energy Generators</h2>

          <p class="section-description">
            Manage your energy production sources. Use +/- buttons to adjust generator counts.
          </p>

          <div class="generator-controls">
            @for (type of availableTypes; track type[0]) {
              <mat-card
                class="generator-control-card"
                [class.selected]="selectedType === type[0]"
                (click)="selectType(type[0])"
              >
                <mat-card-header class="generator-type-header">
                  <mat-icon matCardAvatar>{{ type[1].icon }}</mat-icon>
                  <mat-card-title class="generator-name">{{ type[1].label }}</mat-card-title>
                  <mat-card-subtitle class="generator-rate">{{ type[1].productionRate }} kWh each</mat-card-subtitle>
                </mat-card-header>

                <mat-card-content>
                  <div class="generator-counter">
                    <button
                      mat-icon-button
                      type="button"
                      class="counter-btn decrement"
                      (click)="decrementGenerator(type[0]); $event.stopPropagation()"
                      [disabled]="getGeneratorCount(type[0]) === 0"
                    >
                      <mat-icon>remove</mat-icon>
                    </button>

                    <div class="counter-display">
                      <span class="counter-value">{{ getGeneratorCount(type[0]) }}</span>
                      <span class="counter-label">generators</span>
                    </div>

                    <button
                      mat-icon-button
                      type="button"
                      class="counter-btn increment"
                      (click)="incrementGenerator(type[0]); $event.stopPropagation()"
                    >
                      <mat-icon>add</mat-icon>
                    </button>
                  </div>

                  <div class="generator-total">
                    Total: {{ getTotalProduction(type[0]) }} kWh
                  </div>
                </mat-card-content>
              </mat-card>
            }
          </div>

          <!-- Selected Generator Status -->
          @if (selectedType) {
            <div class="status-section">
              <h3 class="status-title">Status for {{ getSelectedTypeLabel() }} Generators</h3>
              <mat-form-field appearance="outline" class="form-field-full">
                <mat-label>Generator Status</mat-label>
                <mat-select
                  formControlName="generatorStatus"
                  (selectionChange)="updateAllGeneratorStatus()"
                >
                  <mat-option value="Active">Active</mat-option>
                  <mat-option value="Inactive">Inactive</mat-option>
                  <mat-option value="Maintenance">Maintenance</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          }
        </section>

        <!-- Summary Section -->
        @if (getTotalGenerators() > 0) {
          <section class="form-section">
            <h2 class="section-title">Generator Summary</h2>

            <mat-card appearance="outlined" class="summary-card">
              <mat-card-content>
                <div class="total-summary">
                  <div class="total-item">
                    <span class="total-label">Total Generators:</span>
                    <span class="total-value">{{ getTotalGenerators() }}</span>
                  </div>
                  <div class="total-item">
                    <span class="total-label">Total Production:</span>
                    <span class="total-value">{{ getOverallTotalProduction() }} kWh</span>
                  </div>
                </div>

                <mat-divider class="summary-divider"></mat-divider>

                <div class="type-breakdown">
                  @for (type of availableTypes; track type[0]) {
                    @if (getGeneratorCount(type[0]) > 0) {
                      <div class="breakdown-item">
                        <mat-icon class="breakdown-icon">{{ type[1].icon }}</mat-icon>
                        <span class="breakdown-type">{{ type[1].label }}:</span>
                        <span class="breakdown-count">{{ getGeneratorCount(type[0]) }}</span>
                        <span class="breakdown-production">({{ getTotalProduction(type[0]) }} kWh)</span>
                      </div>
                    }
                  }
                </div>
              </mat-card-content>
            </mat-card>
          </section>
        }

        <!-- Form Actions -->
        <section class="form-actions">
          <button
            mat-stroked-button
            type="button"
            color="basic"
            (click)="router.navigate(['/'])"
          >
            Cancel
          </button>
          <button
            mat-raised-button
            type="submit"
            color="primary"
            [disabled]="userForm.invalid"
          >
            {{ isEditMode ? 'Update User' : 'Create User' }}
          </button>
        </section>
      </form>
    </mat-card-content>
  </mat-card>
</div>
